<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Rooms</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 50%;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
    </style>
</head>

<body>
    <h1>Available Rooms</h1>
    <table id="rooms-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Members</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const socket = io('http://localhost:5000');

        socket.on('rooms_info', data => {
            const tbody = document.querySelector('#rooms-table tbody');
            tbody.innerHTML = '';
            data.rooms.forEach(room => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${room.room_id}</td>
            <td>${room.room_name}</td>
            <td>${room.members}</td>
            <td><button class="join-btn" data-room-id="${room.room_id}">Join</button></td>
          `;
                tbody.appendChild(row);
            });
        });

        document.querySelector('#rooms-table tbody').addEventListener('click', e => {
            if (!e.target.matches('.join-btn')) return;
            const roomId = e.target.dataset.roomId;
            localStorage.setItem('current_room', roomId);
            window.location.href = `/r`;
        });
    </script>
</body>

</html>